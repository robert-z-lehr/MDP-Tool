<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Markov Decision Process (MDP) Solver</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="centered">
    <h1>Markov Decision Process (MDP) Solver</h1>
    <h2>The Bellman Equation</h2>
    <p class="lede">
      The Bellman equation expresses the value of a state as the immediate cost (or reward)
      plus the value of the next state under an optimal choice. In a finite-horizon MDP with
      terminal stage <code>T</code> and salvage value <code>V<sub>T</sub>(s)</code>, the backward recursion is
      <code>V<sub>t</sub>(s) = min<sub>a</sub> [ c<sub>t</sub>(s,a) + Σ<sub>s′</sub> P<sub>t</sub>(s′|s,a) · V<sub>t+1</sub>(s′) ]</code>.
    </p>
    <h2>Dynamic Programming</h2>
    <p class="lede">
      Dynamic programming (DP) solves MDPs by breaking the problem into stages and applying the
      Bellman recursion from the terminal stage back to the first. Markov choice uses only the
      current state to choose an action, which aligns with the DP decomposition.
    </p>
  </header>

  <main>
    <!-- Problem description -->
    <section class="panel">
      <label class="panel-title" for="problem">Describe the problem</label>
      <textarea id="problem" rows="5" placeholder="Example: A delivery robot navigates zones (A,B,C). Each hour it may wait, charge, or deliver. Costs differ by action and zone. Horizon T=4. Provide a transition matrix and cost matrix; salvage value is zero."></textarea>
      <div class="actions-row">
        <button id="exampleBtn" class="ghost">Auto-Fill Example</button>
        <button id="solveBtn">Solve</button>
      </div>
    </section>

    <!-- Inputs: 7 boxes (two rows: 4 + 3) -->
    <section class="grid grid-4">
      <!-- Row 1 (4 inputs) -->
      <div class="panel">
        <label class="panel-title" for="states">States</label>
        <textarea id="states" rows="3" placeholder="Comma-separated: A,B,C"></textarea>
      </div>

      <div class="panel">
        <label class="panel-title" for="stages">Stages</label>
        <input id="stages" type="number" min="1" value="4" placeholder="e.g., 4">
      </div>

      <div class="panel">
        <label class="panel-title" for="actions">Actions</label>
        <textarea id="actions" rows="3" placeholder="Comma-separated: wait,charge,deliver"></textarea>
      </div>

      <div class="panel">
        <label class="panel-title" for="constraints">Constraints</label>
        <textarea id="constraints" rows="3" placeholder="Optional notes, e.g., energy ≤ 100; cannot deliver in C"></textarea>
      </div>
    </section>

    <section class="grid grid-3">
      <!-- Row 2 (3 inputs) -->
      <div class="panel">
        <label class="panel-title" for="transitions">Transition Matrix</label>
        <textarea id="transitions" rows="8" placeholder='Stationary JSON:
{
  "A": { "wait": {"A":0.8,"B":0.2}, "charge": {"A":0.9,"B":0.1}, "deliver":{"B":0.7,"C":0.3} },
  "B": { "wait": {"B":0.8,"C":0.2}, "charge": {"A":0.4,"B":0.6}, "deliver":{"C":0.8,"B":0.2} },
  "C": { "wait": {"C":1.0}, "charge": {"B":1.0}, "deliver":{"C":1.0} }
}

Time-varying by stage (wrap in t):
{
  "0": { ... }, "1": { ... }
}'></textarea>
      </div>

      <div class="panel">
        <label class="panel-title" for="costs">Cost Matrix</label>
        <textarea id="costs" rows="8" placeholder='Stationary JSON:
{
  "A":{"wait":1,"charge":3,"deliver":2},
  "B":{"wait":1,"charge":3,"deliver":2},
  "C":{"wait":1,"charge":3,"deliver":4}
}

Time-varying by stage:
{
  "0": { "A":{"wait":1,...}, "B":{...}, "C":{...} },
  "1": { ... }
}'></textarea>
      </div>

      <div class="panel">
        <label class="panel-title" for="salvage">Salvage Value</label>
        <textarea id="salvage" rows="8" placeholder='JSON mapping state → V_T(s), e.g.:
{ "A":0, "B":0, "C":0 }'></textarea>
      </div>
    </section>

    <!-- Output -->
    <section class="panel">
      <div class="panel-title">Output — Value Function</div>
      <pre id="valueFn" class="output">(click Solve)</pre>
    </section>
  </main>

  <footer>
    <small>© 2025 — MDP Solver (finite-horizon, undiscounted). All computation runs in your browser.</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
